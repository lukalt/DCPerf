diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/client/AdSimClient.cpp adsim/cpp2/client/AdSimClient.cpp
--- adsim_src/cpp2/client/AdSimClient.cpp	2025-08-11 16:40:31.472748522 -0700
+++ adsim/cpp2/client/AdSimClient.cpp	2025-08-08 01:31:53.325973824 -0700
@@ -14,17 +14,15 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/client/TLSConnect.h>
 #include <folly/SocketAddress.h>
 #include <folly/coro/BlockingWait.h>
 #include <folly/init/Init.h>
 #include <folly/io/async/EventBase.h>
 #include <folly/io/async/NotificationQueue.h>
-// clang-format off (import order matters)
-#include <cea/chips/adsim/cpp2/client/CoWorker.h>
-// clang-format on
-#include <cea/chips/adsim/if/gen-cpp2/AdSim.h>
 #include <thrift/lib/cpp2/async/RocketClientChannel.h>
+#include "CoWorker.h"
+#include "TLSConnect.h"
+#include "if/gen-cpp2/AdSim.h"
 
 DEFINE_string(host, "::1", "AdSimServer host");
 DEFINE_int32(port, 10086, "AdSimServer port");
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/client/CoWorker.h adsim/cpp2/client/CoWorker.h
--- adsim_src/cpp2/client/CoWorker.h	2025-08-11 16:40:31.473506519 -0700
+++ adsim/cpp2/client/CoWorker.h	2025-08-08 01:31:53.329657548 -0700
@@ -16,14 +16,16 @@
 
 #pragma once
 
-#include <cea/chips/adsim/if/gen-cpp2/AdSim.h>
 #include <fizz/client/AsyncFizzClient.h>
 #include <folly/MoveWrapper.h>
+#include <folly/coro/Task.h>
 #include <folly/futures/Promise.h>
 #include <folly/io/async/EventBase.h>
 #include <folly/io/async/NotificationQueue.h>
 #include <thrift/lib/cpp2/async/RocketClientChannel.h>
 #include <thrift/lib/cpp2/security/extensions/ThriftParametersClientExtension.h>
+#include "TLSConnect.h"
+#include "if/gen-cpp2/AdSim.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/AdSimServer.cpp adsim/cpp2/server/AdSimServer.cpp
--- adsim_src/cpp2/server/AdSimServer.cpp	2025-08-11 16:40:31.492003858 -0700
+++ adsim/cpp2/server/AdSimServer.cpp	2025-08-11 16:25:52.981966551 -0700
@@ -19,8 +19,6 @@
 #include <streambuf>
 #include <string>
 
-#include <cea/chips/adsim/cpp2/server/AdSimService.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Dwarfs.h>
 #include <fizz/fizz-config.h>
 #include <fizz/server/FizzServerContext.h>
 #include <folly/init/Init.h>
@@ -33,6 +31,8 @@
 #include <thrift/lib/cpp2/server/ThriftServer.h>
 #include <wangle/acceptor/FizzConfig.h>
 #include <wangle/acceptor/FizzConfigUtil.h>
+#include "cpp2/server/AdSimService.h"
+#include "cpp2/server/dwarfs/Dwarfs.h"
 
 DEFINE_string(config_file, "", "A json file of configurations");
 DEFINE_int32(port, -1, "Overwrite port in the config file");
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/AdSimService.cpp adsim/cpp2/server/AdSimService.cpp
--- adsim_src/cpp2/server/AdSimService.cpp	2025-08-11 16:40:31.492560931 -0700
+++ adsim/cpp2/server/AdSimService.cpp	2025-08-08 01:31:53.339773896 -0700
@@ -14,8 +14,8 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/AdSimService.h>
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
+#include "cpp2/server/AdSimService.h"
+#include "cpp2/server/DataObjects.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Collect.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/AdSimService.h adsim/cpp2/server/AdSimService.h
--- adsim_src/cpp2/server/AdSimService.h	2025-08-11 16:40:31.493090351 -0700
+++ adsim/cpp2/server/AdSimService.h	2025-08-08 01:31:53.341792209 -0700
@@ -22,10 +22,10 @@
 #include <folly/Executor.h>
 #include <folly/MapUtil.h>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
-#include <cea/chips/adsim/if/gen-cpp2/AdSim.h>
 #include <fb303/BaseService.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
+#include "if/gen-cpp2/AdSim.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/DataObjects.cpp adsim/cpp2/server/DataObjects.cpp
--- adsim_src/cpp2/server/DataObjects.cpp	2025-08-11 16:40:31.494161142 -0700
+++ adsim/cpp2/server/DataObjects.cpp	2025-08-08 01:31:53.343138967 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
+#include "cpp2/server/DataObjects.h"
 #include <folly/Singleton.h>
 
 namespace facebook::cea::chips::adsim {
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/DataObjects.h adsim/cpp2/server/DataObjects.h
--- adsim_src/cpp2/server/DataObjects.h	2025-08-11 16:40:31.494634076 -0700
+++ adsim/cpp2/server/DataObjects.h	2025-08-08 01:31:53.345321770 -0700
@@ -27,7 +27,7 @@
 #include <thrift/lib/cpp2/protocol/CompactProtocol.h>
 #include <thrift/lib/cpp2/protocol/Serializer.h>
 
-#include <cea/chips/adsim/if/gen-cpp2/AdSim.h>
+#include "if/gen-cpp2/AdSim.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Compress.cc adsim/cpp2/server/dwarfs/Compress.cc
--- adsim_src/cpp2/server/dwarfs/Compress.cc	2025-08-11 16:40:31.479344550 -0700
+++ adsim/cpp2/server/dwarfs/Compress.cc	2025-08-08 01:31:53.347193603 -0700
@@ -18,10 +18,10 @@
 #include <util.h>
 
 #include <glog/logging.h>
-#include <cstring>
+#include <string.h>
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/Compress.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "Compress.h"
+#include "Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Task.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Compress.h adsim/cpp2/server/dwarfs/Compress.h
--- adsim_src/cpp2/server/dwarfs/Compress.h	2025-08-11 16:40:31.479879439 -0700
+++ adsim/cpp2/server/dwarfs/Compress.h	2025-08-08 01:31:53.349828359 -0700
@@ -21,8 +21,8 @@
 
 #include <string.h>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/coro/Task.h>
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/ConcurrentHashMap.cc adsim/cpp2/server/dwarfs/ConcurrentHashMap.cc
--- adsim_src/cpp2/server/dwarfs/ConcurrentHashMap.cc	2025-08-11 16:40:31.480419906 -0700
+++ adsim/cpp2/server/dwarfs/ConcurrentHashMap.cc	2025-08-08 01:31:53.352038533 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/ConcurrentHashMap.h>
+#include "ConcurrentHashMap.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/executors/CPUThreadPoolExecutor.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/ConcurrentHashMap.h adsim/cpp2/server/dwarfs/ConcurrentHashMap.h
--- adsim_src/cpp2/server/dwarfs/ConcurrentHashMap.h	2025-08-11 16:40:31.480872341 -0700
+++ adsim/cpp2/server/dwarfs/ConcurrentHashMap.h	2025-08-08 01:31:53.353758745 -0700
@@ -30,8 +30,8 @@
 #include <utility>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/Likely.h>
 #include <folly/SharedMutex.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/DeepCopy.h adsim/cpp2/server/dwarfs/DeepCopy.h
--- adsim_src/cpp2/server/dwarfs/DeepCopy.h	2025-08-11 16:40:31.481349933 -0700
+++ adsim/cpp2/server/dwarfs/DeepCopy.h	2025-08-08 01:31:53.355437176 -0700
@@ -24,8 +24,8 @@
 #include <unordered_map>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/container/F14Map.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Delay.h adsim/cpp2/server/dwarfs/Delay.h
--- adsim_src/cpp2/server/dwarfs/Delay.h	2025-08-11 16:40:31.481921437 -0700
+++ adsim/cpp2/server/dwarfs/Delay.h	2025-08-08 01:31:53.357004548 -0700
@@ -18,8 +18,8 @@
 
 #include <unistd.h>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Task.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Dwarfs.cc adsim/cpp2/server/dwarfs/Dwarfs.cc
--- adsim_src/cpp2/server/dwarfs/Dwarfs.cc	2025-08-11 16:40:31.482560714 -0700
+++ adsim/cpp2/server/dwarfs/Dwarfs.cc	2025-08-08 01:31:53.359184566 -0700
@@ -19,21 +19,21 @@
 #include <folly/MapUtil.h>
 #include <folly/dynamic.h>
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/Compress.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/ConcurrentHashMap.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/DeepCopy.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Delay.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Dwarfs.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Embedding.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/FakeIO.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/GEMM.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/HashMap.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/IBRun.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Rebatch.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Serialize.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Shape.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/TensorDeser.h>
+#include "Compress.h"
+#include "ConcurrentHashMap.h"
+#include "DeepCopy.h"
+#include "Delay.h"
+#include "Dwarfs.h"
+#include "Embedding.h"
+#include "FakeIO.h"
+#include "GEMM.h"
+#include "HashMap.h"
+#include "IBRun.h"
+#include "Kernel.h"
+#include "Rebatch.h"
+#include "Serialize.h"
+#include "Shape.h"
+#include "TensorDeser.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Dwarfs.h adsim/cpp2/server/dwarfs/Dwarfs.h
--- adsim_src/cpp2/server/dwarfs/Dwarfs.h	2025-08-11 16:40:31.483412603 -0700
+++ adsim/cpp2/server/dwarfs/Dwarfs.h	2025-08-08 01:31:53.672498594 -0700
@@ -19,9 +19,9 @@
 #include <string>
 
 #include <folly/MapUtil.h>
-#include <folly/json/dynamic.h>
+#include <folly/dynamic.h>
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/dwarfs/Kernel.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Embedding.cc adsim/cpp2/server/dwarfs/Embedding.cc
--- adsim_src/cpp2/server/dwarfs/Embedding.cc	2025-08-11 16:40:31.484095456 -0700
+++ adsim/cpp2/server/dwarfs/Embedding.cc	2025-08-08 01:31:53.793356796 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/Embedding.h>
+#include "Embedding.h"
 
 #include <algorithm>
 #include <chrono>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Embedding.h adsim/cpp2/server/dwarfs/Embedding.h
--- adsim_src/cpp2/server/dwarfs/Embedding.h	2025-08-11 16:40:31.484635663 -0700
+++ adsim/cpp2/server/dwarfs/Embedding.h	2025-08-08 01:31:53.796436736 -0700
@@ -21,8 +21,8 @@
 #include <random>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Task.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/FakeIO.h adsim/cpp2/server/dwarfs/FakeIO.h
--- adsim_src/cpp2/server/dwarfs/FakeIO.h	2025-08-11 16:40:31.485038282 -0700
+++ adsim/cpp2/server/dwarfs/FakeIO.h	2025-08-08 01:31:53.798474870 -0700
@@ -18,8 +18,8 @@
 
 #include <unistd.h>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Task.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/GEMM.cc adsim/cpp2/server/dwarfs/GEMM.cc
--- adsim_src/cpp2/server/dwarfs/GEMM.cc	2025-08-11 16:40:31.485520802 -0700
+++ adsim/cpp2/server/dwarfs/GEMM.cc	2025-08-08 01:31:53.800483990 -0700
@@ -22,17 +22,21 @@
 #include <glog/logging.h>
 
 #ifdef _OPENMP
+#include <omp.h>
 #endif
 
 #ifdef USE_MKL
+#include <mkl.h>
 #endif
 
 #include "bench/BenchUtils.h"
 #include "fbgemm/Fbgemm.h"
+#include "src/RefImplementations.h"
 #include "test/QuantizationHelpers.h"
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/GEMM.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include <folly/coro/Task.h>
+#include "GEMM.h"
+#include "Kernel.h"
 
 using namespace std;
 using namespace fbgemm;
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/GEMM.h adsim/cpp2/server/dwarfs/GEMM.h
--- adsim_src/cpp2/server/dwarfs/GEMM.h	2025-08-11 16:40:31.486000186 -0700
+++ adsim/cpp2/server/dwarfs/GEMM.h	2025-08-08 01:31:53.803664512 -0700
@@ -22,8 +22,8 @@
 
 #include <assert.h>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/coro/Collect.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/HashMap.cc adsim/cpp2/server/dwarfs/HashMap.cc
--- adsim_src/cpp2/server/dwarfs/HashMap.cc	2025-08-11 16:40:31.486475546 -0700
+++ adsim/cpp2/server/dwarfs/HashMap.cc	2025-08-08 01:31:53.806319500 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/HashMap.h>
+#include "HashMap.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/HashMap.h adsim/cpp2/server/dwarfs/HashMap.h
--- adsim_src/cpp2/server/dwarfs/HashMap.h	2025-08-11 16:40:31.486935100 -0700
+++ adsim/cpp2/server/dwarfs/HashMap.h	2025-08-08 01:31:53.808046744 -0700
@@ -24,8 +24,8 @@
 #include <unordered_map>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/Synchronized.h>
 #include <folly/container/F14Map.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/IBRun.h adsim/cpp2/server/dwarfs/IBRun.h
--- adsim_src/cpp2/server/dwarfs/IBRun.h	2025-08-11 16:40:31.487406294 -0700
+++ adsim/cpp2/server/dwarfs/IBRun.h	2025-08-08 01:31:53.809471208 -0700
@@ -16,9 +16,9 @@
 
 #pragma once
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/icache_buster/ICacheBuster.h> // @manual=//cea/chips/adsim/cpp2/server/dwarfs/icache_buster:libicachebuster
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
+#include "cpp2/server/dwarfs/icache_buster/ICacheBuster.h" // @manual=//cea/chips/adsim/cpp2/server/dwarfs/icache_buster:libicachebuster
 
 #include <folly/coro/Task.h>
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/icache_buster/gen_icache_buster.py adsim/cpp2/server/dwarfs/icache_buster/gen_icache_buster.py
--- adsim_src/cpp2/server/dwarfs/icache_buster/gen_icache_buster.py	2025-08-11 16:40:31.478209463 -0700
+++ adsim/cpp2/server/dwarfs/icache_buster/gen_icache_buster.py	2025-08-08 01:31:53.810996567 -0700
@@ -14,8 +14,6 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-# pyre-unsafe
-
 """Module to split file into multiple segments."""
 
 import argparse
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Kernel.cc adsim/cpp2/server/dwarfs/Kernel.cc
--- adsim_src/cpp2/server/dwarfs/Kernel.cc	2025-08-11 16:40:31.487821412 -0700
+++ adsim/cpp2/server/dwarfs/Kernel.cc	2025-08-08 01:31:53.811870810 -0700
@@ -20,7 +20,7 @@
 #include <fb303/ExportType.h>
 #include <fb303/ThreadCachedServiceData.h>
 
-#include "cea/chips/adsim/cpp2/server/dwarfs/Kernel.h"
+#include "Kernel.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Kernel.h adsim/cpp2/server/dwarfs/Kernel.h
--- adsim_src/cpp2/server/dwarfs/Kernel.h	2025-08-11 16:40:31.488430894 -0700
+++ adsim/cpp2/server/dwarfs/Kernel.h	2025-08-08 01:31:53.813180731 -0700
@@ -21,10 +21,10 @@
 #include <unordered_map>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
 #include <folly/coro/Task.h>
-#include <folly/json/dynamic.h>
+#include <folly/dynamic.h>
 #include <glog/logging.h>
+#include "cpp2/server/DataObjects.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Rebatch.cc adsim/cpp2/server/dwarfs/Rebatch.cc
--- adsim_src/cpp2/server/dwarfs/Rebatch.cc	2025-08-11 16:40:31.488863107 -0700
+++ adsim/cpp2/server/dwarfs/Rebatch.cc	2025-08-08 01:31:53.814875957 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/Rebatch.h>
+#include "Rebatch.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/futures/Future.h>
@@ -466,7 +466,7 @@
 
   // Select execution mode based on thread configuration and pool availability
   if (num_threads_ > 1 && pool) {
-    co_await rebatch_multi_thread(std::move(pool));
+    co_await rebatch_multi_thread(pool);
   } else {
     rebatch_single_thread();
   }
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Rebatch.h adsim/cpp2/server/dwarfs/Rebatch.h
--- adsim_src/cpp2/server/dwarfs/Rebatch.h	2025-08-11 16:40:31.489349233 -0700
+++ adsim/cpp2/server/dwarfs/Rebatch.h	2025-08-08 01:31:53.816348796 -0700
@@ -26,8 +26,8 @@
 #include <string>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/CppAttributes.h>
 #include <folly/coro/Task.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Serialize.h adsim/cpp2/server/dwarfs/Serialize.h
--- adsim_src/cpp2/server/dwarfs/Serialize.h	2025-08-11 16:40:31.489813905 -0700
+++ adsim/cpp2/server/dwarfs/Serialize.h	2025-08-08 01:31:53.818122610 -0700
@@ -20,15 +20,15 @@
 
 #include <algorithm>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/coro/Task.h>
 
 #include <thrift/lib/cpp2/protocol/CompactProtocol.h>
 #include <thrift/lib/cpp2/protocol/Serializer.h>
 
-#include <cea/chips/adsim/if/gen-cpp2/Serialize_types.h>
+#include "if/gen-cpp2/Serialize_types.h"
 
 namespace facebook::cea::chips::adsim {
 
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/Shape.h adsim/cpp2/server/dwarfs/Shape.h
--- adsim_src/cpp2/server/dwarfs/Shape.h	2025-08-11 16:40:31.490449888 -0700
+++ adsim/cpp2/server/dwarfs/Shape.h	2025-08-08 01:31:53.820252441 -0700
@@ -16,10 +16,10 @@
 
 #pragma once
 
-#include <cea/chips/adsim/cpp2/client/TLSConnect.h>
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
-#include <cea/chips/adsim/if/gen-cpp2/AdSim.h>
+#include "cpp2/client/TLSConnect.h"
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
+#include "if/gen-cpp2/AdSim.h"
 
 #include <fb303/ThreadCachedServiceData.h>
 #include <folly/MoveWrapper.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/TensorDeser.cc adsim/cpp2/server/dwarfs/TensorDeser.cc
--- adsim_src/cpp2/server/dwarfs/TensorDeser.cc	2025-08-11 16:40:31.490953359 -0700
+++ adsim/cpp2/server/dwarfs/TensorDeser.cc	2025-08-08 01:31:53.822218296 -0700
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-#include <cea/chips/adsim/cpp2/server/dwarfs/TensorDeser.h>
+#include "TensorDeser.h"
 #include <cstring>
 #include <iomanip>
 #include <iostream>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/cpp2/server/dwarfs/TensorDeser.h adsim/cpp2/server/dwarfs/TensorDeser.h
--- adsim_src/cpp2/server/dwarfs/TensorDeser.h	2025-08-11 16:40:31.491549360 -0700
+++ adsim/cpp2/server/dwarfs/TensorDeser.h	2025-08-08 01:31:53.823774331 -0700
@@ -30,8 +30,8 @@
 #include <tuple>
 #include <vector>
 
-#include <cea/chips/adsim/cpp2/server/DataObjects.h>
-#include <cea/chips/adsim/cpp2/server/dwarfs/Kernel.h>
+#include "cpp2/server/DataObjects.h"
+#include "cpp2/server/dwarfs/Kernel.h"
 
 #include <folly/FileUtil.h>
 #include <folly/Format.h>
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/if/AdSim.thrift adsim/if/AdSim.thrift
--- adsim_src/if/AdSim.thrift	2025-08-11 16:40:31.496943961 -0700
+++ adsim/if/AdSim.thrift	2025-08-08 01:31:53.825487714 -0700
@@ -1,4 +1,4 @@
-include "common/fb303/if/fb303.thrift"
+include "fb303.thrift"
 
 namespace cpp2 facebook.cea.chips.adsim
 namespace py3 facebook.cea.chips.adsim
diff -wbBdu -ruN '--exclude=.git' '--exclude=*.rej' '--exclude=*.orig' '--exclude=gen-cpp2' '--exclude=build' '--exclude=third_party' adsim_src/if/Serialize.thrift adsim/if/Serialize.thrift
--- adsim_src/if/Serialize.thrift	2025-08-11 16:40:31.497838213 -0700
+++ adsim/if/Serialize.thrift	2025-08-08 01:31:53.827141065 -0700
@@ -3,20 +3,15 @@
 cpp_include "list"
 cpp_include "folly/container/F14Map.h"
 
-include "thrift/annotation/cpp.thrift"
-
 struct SerializableInfo {
   1: bool var_bool;
   2: i32 var_i32;
   3: double var_double;
 }
 
-@cpp.Type{template = "std::list"}
-typedef list<i32> id_list_t
-@cpp.Type{template = "folly::F14VectorMap"}
-typedef map<i32, id_list_t> id_map_t
-@cpp.Type{template = "std::list"}
-typedef list<SerializableInfo> info_list_t
+typedef list<i32> (cpp.template = "std::list") id_list_t
+typedef map<i32, id_list_t> (cpp.template = "folly::F14VectorMap") id_map_t
+typedef list<SerializableInfo> (cpp.template = "std::list") info_list_t
 
 struct SerializableUnit {
   1: id_map_t map_of_list;
@@ -24,8 +19,7 @@
   3: id_list_t list_of_i32;
 }
 
-@cpp.Type{template = "std::list"}
-typedef list<SerializableUnit> unit_list_t
+typedef list<SerializableUnit> (cpp.template = "std::list") unit_list_t
 
 struct SerializableReq {
   1: i64 var_i64;
